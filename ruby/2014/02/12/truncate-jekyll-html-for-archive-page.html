<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Truncating HTML while Preserving Structure | The Simple</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Jekyll" />
    <meta name="author" content="John" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="http://www.johninux.com/css/style.css" type="text/css" />
    <link rel="stylesheet" href="http://www.johninux.com/css/syntax.css" type="text/css" />
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/atom.xml" />
    <link rel="shortcut icon" href="http://www.johninux.com/favicon.ico" type="image/x-icon" />
    <!--[if lt IE 9]>
    <script src="http://www.johninux.com/js/html5.js" type="text/javascript"></script>
    <![endif]-->

    <!-- mathjax js is been used for mathematical formula -->
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
</head>
<body id="default">
<div id="head-line"></div>
<div id="content">
    <header id="head">
        <div id="logo">
            <img src="http://www.johninux.com/images/head_portrait.png" class="bio-photo" alt=" bio photo">
            <h2>Simple</h2>
        </div>
        <nav id="nav">
            <ul>
                <li class="fn-clear"><a href="http://www.johninux.com" rel="nofollow" class="action"><i class="icon-home"></i> Home</a></li>
                <li class="fn-clear"><a href="http://www.johninux.com/archives.html"><i class="icon-list-ul"></i> Archives</a></li>
                <li class="fn-clear"><a href="mailto:zhaoxuan1727@gmail.com"><i class="icon-envelope-alt"></i> Contact</a></li>
                <li class="fn-clear"><a href="http://www.johninux.com/contact.html"><i class="icon-comments-alt"></i> About </a></li>
            </ul>
        </nav>
    </header>
    <section id="contain">
        <header id="begin">
            <h1 class="post-title">Truncating HTML while Preserving Structure</h1>
        </header>
		<article class="post">
    <!-- <h1 class="post-title">Truncating HTML while Preserving Structure</h1> -->
    <p>Truncating HTML is a bit of a pain - in a recent effory to change the layout of my site, I updated the index page to show the last five posts - truncated, of course.</p>

<p>The problem with doing this is that the most common method of truncating a post is to remove all markup and truncate the remaining string. This would be fine, but for a site with a fair amount of colorized code examples (courtesy of <a href="http://pygments.org/" title="Title">Pigments</a>), it can look a little weird.</p>

<p>A better solution would be to truncate based on the number of characters, yet retain the markup, which is where <a href="https://github.com/MattHall/truncatehtml" title="Title">this cheeky snippet</a> of code comes in.</p>

<p>Requirements</p>

<p>The truncator requires <a href="http://nokogiri.org/" title="Title">Nokogiri</a> to parse out the HTML string.</p>

<p>Usage</p>

<p>If you’re using Jekyll, add the html_filters.rb file to your _plugins directory - this will give you the helper truncatehtml as a <a href="http://liquidmarkup.org/" title="Title">Liquid</a> filter. In your views, you can use this function in the same way as you would use the normal truncate filter:</p>

<div class="highlight"><pre><code class="language-html" data-lang="html">page.content | truncatehtml: 500</code></pre></div>

<p>How it works</p>

<p>Given a snippet of HTML, we use Nokogiri to parse it into a tree. This takes care of all of the messiness of dealing with HTML, and gives us back a tree of nodes representing the parsed snippet.</p>

<p>Now that we have the tree of nodes, we can traverse it depth-first. All text nodes are leaf nodes, so when we encounter one, we can count the length of the text.</p>

<p>Once we have all of the text we need, we continue traversing, but instead of counting text lengths, we delete all of the nodes we see after we’ve reached our maximum length.</p>

<p>After that, we have a tree of nodes that represent the truncated tree, and the can output the appropriate HTML.</p>

<p><a href="http://codebeef.com/articles/truncating-html-while-preserving-structure/" title="Title">truncatehtml</a></p>


    <nav class="pagination-published">Published by John — 12 Feb 2014</nav>

    <nav class="pagination-link">
        
        <a class="prev" href="http://www.johninux.com/linux/2014/01/11/enable-rc-local-in-fedora-20.html" rel="bookmark">&laquo;&nbsp;Enable rc-local in Fedora 20...</a>
        
        
        <a class="next" href="http://www.johninux.com/feeling/2014/02/13/u-dont-understand-me-but-i-am-still-me.html" rel="bookmark">虽然你不了解我，但是我还是我&nbsp;&raquo;</a>
        
     </nav>
     <div id="disqus_thread"></div>
</article>

<!-- disqus -->
<!-- <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'johnzhao'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a> -->
<!-- end_disqus -->
        <footer id="foot">
            <p>&copy; 2015 John Zhao All rights reserved. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/">PIZn</a></p>
        </footer>
    </section>
</div>
<div id="foot-line"></div>
<script src="http://www.johninux.com/js/jquery.js" type="text/javascript"></script>
<script src="http://www.johninux.com/js/jquery.scrollTo.js" type="text/javascript"></script>
<script src="http://www.johninux.com/js/theOne.js" type="text/javascript"></script>
<!-- baidu tongji begin -->
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F2de4c656ec06b5b899ebb2b5148eb2e1' type='text/javascript'%3E%3C/script%3E"));
</script>
<!-- baidu tongji end -->
</body>
</html>
